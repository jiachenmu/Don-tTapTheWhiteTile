# iOS-OCé¡¹ç›® åˆ«è¸©ç™½å—(Don't Tap The White Tile)

***

## å†™åœ¨å‰é¢çš„è¯

#### â‘ åˆ«è¸©ç™½å—æ¸¸æˆç®€ä»‹ï¼š

>ã€Šåˆ«è¸©ç™½å—å„¿ Don't Tap The White Tileã€‹ï¼Œè¿™å°±æ˜¯è¿™ä¸ªæ¸¸æˆå”¯ä¸€çš„ä¸€ä¸ªè§„åˆ™ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸æ–­è¸©ç€é»‘è‰²æ–¹å—å‰è¿›å³å¯ï¼Œå¾ˆç®€å•å§ï¼Ÿè°éƒ½å¯ä»¥ä¼šçŽ©ï¼Œä½†å¹¶ä¸æ˜¯è°éƒ½èƒ½çŽ©å¾—å¾ˆå¥½å™¢ï¼Œä½ å‘¢ï¼Ÿå¿«æ¥æŒ‘æˆ˜çœ‹çœ‹å§ï¼ç»å…¸æ¨¡å¼ï¼Œä»¥æœ€å¿«çš„é€Ÿåº¦åˆ°è¾¾ç»ˆç‚¹ã€‚è¡—æœºæ¨¡å¼ï¼Œä½ æœ‰èƒ½åŠ›å¾—å¤šå°‘åˆ†å°±å¾—å¤šå°‘åˆ†ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œè¿™ä¹Ÿæ˜¯æœ€å…·æŒ‘æˆ˜æ€§çš„ä¸€ä¸ªæ¨¡å¼ã€‚é™æ—¶æ¨¡å¼ï¼Œåœ¨30ç§’å†…çœ‹ä½ èƒ½èµ°å‡ æ­¥ã€‚æžé€Ÿæ¨¡å¼ï¼Œæ²¡æœ‰æœ€é«˜é€Ÿé™åˆ¶çš„è¡—æœºæ¨¡å¼, æŒ‘æˆ˜ä½ çš„æžé™æŽ¥åŠ›æ¨¡å¼ï¼Œè§„å®šæ—¶é—´å†…å®Œæˆ50å—å„¿ï¼Œç„¶åŽä¼šæœ‰æ›´å¤šæ—¶é—´åŽ»å®Œæˆå¦å¤–çš„50å—å„¿ã€‚ã€å¤åˆ¶äºŽç™¾åº¦ç™¾ç§‘ã€‘

å¦‚æžœä½ æ²¡çŽ©è¿‡ï¼Œæ²¡å…³ç³» ï¼Œä¸Šå›¾çœ‹çœ‹
![åˆ«è¸©ç™½å—å„¿.gif](http://upload-images.jianshu.io/upload_images/1299512-1c86ccf35a745617.gif?imageMogr2/auto-orient/strip)
æ„æ€å°±æ˜¯ï¼šæ¯è¡Œæœ‰å››ä¸ªæŒ‰é’®ï¼Œé»‘è‰²çš„æŒ‰é’®æ˜¯æ­£ç¡®çš„éœ€è¦ä½ ç‚¹å‡»çš„æŒ‰é’®ï¼Œç™½è‰²å—ç‚¹å‡»åŽæ¸¸æˆå¤±è´¥ï¼Œæ‰€ä»¥è¿™ä¸ªæ¸¸æˆå°±å«"åˆ«è¸©ç™½å—å„¿"ðŸ˜‚ï¼Œåˆ«é—®æˆ‘æˆ‘ä¸ºä»€ä¹ˆè¿™ä¹ˆæœºæ™ºã€‚

#### â‘¡å†™è¿™ä¸ªå°æ¸¸æˆçš„ç›®çš„

##### **æœ€é‡è¦ :  __çº¯å±žå¥½çŽ©__**

æˆ‘è§‰å¾—åšä¸€ä»¶äº‹æƒ…æœ€å¤§çš„æŽ¨åŠ¨åŠ›å°±æ˜¯ **å…´è¶£** **å…´è¶£** **å…´è¶£**ã€‚
çœ‹åˆ°å¥½å¤šæ¸¸æˆéƒ½æ˜¯æ‹¿Unity3Dã€Cocos2Då¼€å‘çš„ï¼Œæˆ‘å°±æƒ³ æˆ‘ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ä¸€äº›ä¸œæµ·ä¹Ÿå¯ä»¥å®žçŽ°ä¸€äº›ç®€å•çš„å¹³é¢2DåŠ¨ç”»å‘€ï¼Œæ‰€ä»¥æˆ‘è¯•äº†è¯•ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ç¯‡ç®€ä¹¦ã€‚

##### **ç”µå•†ä¹‹ç±»çš„appä¸ç¾Žè§‚**

å‰é¢ä»¿å†™è¿‡[åŠç³–app](http://www.jianshu.com/p/7b57eb0c4abe)ï¼Œå…¬å¸ä¹Ÿæ˜¯ç”µå•†çš„appï¼Œæ‰€ä»¥å¯¹äºŽç”µå•†appæ— çˆ±äº†ï¼Œ,,Ô¾â€¸Ô¾,,ï¼Œéƒ½æ˜¯ é¦–é¡µã€åˆ†ç±»ã€è´­ç‰©è½¦ã€ä¸ªäººä¸­å¿ƒçš„å¥—è·¯ï¼Œä½ æ‡‚çš„ã€‚ç›¸åæˆ‘å€’æ˜¯æ›´å–œæ¬¢ä¸€äº›ç”µå•†å…¥å£çš„APPï¼Œå°±æ¯”å¦‚åŠç³–ã€ç¾Žä¸½è¯´ã€å°çº¢ä¹¦ä¹‹ç±»çš„appï¼ŒUIå¾ˆç¾Žè§‚ï¼Œè¿™æ˜¯å¸å¼•æˆ‘çš„åœ°æ–¹ã€‚

***

## é¡¹ç›®æ•´ä½“çš„æ¦‚æ‹¬

#### â‘ å¼€å‘å‘¨æœŸï¼š 

å·¥ä½œé—²æš‡ä¹‹ä½™ç´¯è®¡æœ‰10å¤©å·¦å³ï¼Œæœ€è¿‘ä¸€ä¸ªåŠæœˆåœ¨å¿™å…¬å¸çš„é¡¹ç›®ï¼Œåªå¥½æŠ½æ—¶é—´å†™å•¦

#### â‘¡å¼€å‘å·¥å…·å’Œè¯­è¨€ï¼š

 å¼€å‘å·¥å…·ä¸ºXcode7.3   è¯­è¨€ä¸ºObjective-C
å› ä¸ºå‰é¢ä»¿å†™åŠç³–appçš„æ—¶å€™ï¼Œå¥½å¤šæœ‹å‹ç»™æˆ‘è¯´ä¸å¤ªæ‡‚swiftï¼Œé‚£æˆ‘å°±å†™ä¸ªOCçš„å°é¡¹ç›®

#### â‘¢å¼€å‘è¦ç‚¹ï¼š 

**æ¸¸æˆæˆåŠŸã€å¤±è´¥çš„é€»è¾‘ä»£ç åŸºäºŽ `ReactiveCocoa` ,ä»£ç æœ‰è¯¦ç»†çš„è§£é‡Šã€‚**
éŸ³é¢‘ç®¡ç†ã€æ•´ä½“çš„UIæ­å»ºä¸éš¾ï¼Œéš¾çš„æ˜¯æ•´ä½“æ¸¸æˆé€»è¾‘çš„è®¾è®¡ã€‚

***

## é¡¹ç›®è¯¦ç»†å®žçŽ°è¿‡ç¨‹

#### â‘ é¦–é¡µï¼Œé¡µé¢è¾ƒä¸ºç®€å•ï¼Œä¸»è¦ä»‹ç»ä¸€ä¸‹ UIButtonä¸Ž `ReactiveCocoa`çš„ç»“åˆä½¿ç”¨

![tmp58f5a0f6.png](http://upload-images.jianshu.io/upload_images/1299512-81e0e7253713d485.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

--ä¸»è¦ä»£ç å¦‚ä¸‹
```
//å¼€å§‹æ¸¸æˆæŒ‰é’®
    _startButton = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH/2, SCREEN_HEIGHT)];
    _startButton.backgroundColor = [UIColor blackColor];
    [_startButton setTitle:@"å¼€å§‹æ¸¸æˆ" forState:UIControlStateNormal];
    [_startButton setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
    WeakSelf;
    [[_startButton rac_signalForControlEvents:UIControlEventTouchUpInside] subscribeNext:^(id x) {
        [weakSelf buttonHideAnimation];
        [weakSelf  presentViewController:[[GameSceneViewController alloc] init] animated:false completion:^{
            //å¼¹å‡ºæ¸¸æˆçª—ä½“åŽ æš‚åœBGM
            [SoundPlayer pauseBGM];
        }];
        NSLog(@" start game :)");
    }];
    [self.view addSubview:_startButton];
```

è§£é‡Šï¼š`[_startButton rac_signalForControlEvents:UIControlEventTouchUpInside] `è¿”å›žä¸€ä¸ª `RACSignal`,å¯ä»¥ç†è§£ä¸º ä¸€ä¸ªä¿¡å·ï¼ŒåŽé¢ `subscribeNext:^(id x) {}` æ„æ€å°±æ˜¯ æŽ¥å—åˆ°è¿™ä¸ªä¿¡å·æ‰€åšçš„æ“ä½œã€‚ä»Žå­—é¢æ„æ€ä¸Šå¯ä»¥ç†è§£ä¸ºï¼Œå‰è€…å½“ä½ ç‚¹å‡»æŒ‰é’®ï¼Œè§¦å‘`UIControlEventTouchUpInside`äº‹ä»¶çš„æ—¶å€™ ï¼Œå‘å‡ºä¸€ä¸ªä¿¡å·ï¼ŒåŽè€…æ˜¯æŽ¥å—åˆ°è¿™ä¸ªä¿¡å·ï¼Œä½ è¦å¹²ä»€ä¹ˆï¼Œç”±ä½ å†³å®šã€‚

#### â‘¡æ¸¸æˆé¡µé¢viewï¼Œ
 ##### å€’è®¡æ—¶åŠ¨ç”»ä»‹ç»
ä¸Šå›¾ï¼š

![å€’è®¡æ—¶åŠ¨ç”».gif](http://upload-images.jianshu.io/upload_images/1299512-76ac222f93784caa.gif?imageMogr2/auto-orient/strip)
----æž„æˆï¼šviewèƒŒæ™¯ä¸ºé»‘è‰²ï¼Œä¸­é—´æ·»åŠ äº†ä¸€ä¸ªlabelï¼Œæ˜¾ç¤ºå½“å‰çš„æ•°å­—

```
/**
*  å€’è®¡æ—¶ anim ......3 2 1 åŠ¨ç”»
*
*  @param anim          anim å˜åŒ–çš„æ•°å­—åˆå§‹å€¼
*  @param completeBlock åŠ¨ç”»ç»“æŸåŽçš„æ“ä½œ
*/
- (void)showWithAnimNum:(NSInteger)anim CompleteBlock:(CompleteBlock)completeBlock;
```
----å®žçŽ°æ€è·¯ï¼š è¦åšçš„ä»Žç»™å®šçš„å‚æ•° `anim `  é€’å‡åˆ° 0  ä¹‹åŽç»“æŸåŠ¨ç”»ï¼Œç„¶åŽæ‰§è¡Œ`completeBlock`
ï¼Œæˆ‘æ˜¯è¿™æ ·å†™ä¸€ä¸ªç±»ä¼¼äºŽé€’å½’çš„åŠ¨ç”»ï¼š
â‘ æ•´ä½“åŠ¨ç”»å¯ä»¥åˆ†ä¸ºå¾ˆå¤šä¸ªï¼Œå•ä¸ªæ•°å­—ï¼Œåšç¼©æ”¾å’Œé€æ˜Žåº¦æ”¹å˜çš„åŠ¨ç”»ç»„
```
//è¿”å›žä¸€ä¸ª åŠ¨ç”»group
- (CAAnimationGroup *)animationGroup {
    //ç¼©æ”¾
    CABasicAnimation *animation1 = [CABasicAnimation animation];
    [animation1 setKeyPath:@"transform.scale"];
    [animation1 setFromValue:@1.0];
    [animation1 setToValue:@4.0];
    [animation1 setDuration:1.0];
    //æ”¹å˜é€æ˜Žåº¦
    CABasicAnimation *animation2 = [CABasicAnimation animation];
    [animation2 setKeyPath:@"alpha"];
    [animation2 setFromValue:@1.0];
    [animation2 setToValue:@0.3];
    [animation2 setDuration:1.0];
    
    
    CAAnimationGroup *animGroup = [[CAAnimationGroup alloc] init];
    animGroup.animations = [NSArray arrayWithObjects:animation1,animation2, nil];
    [animGroup setDuration:1.0];
    [animGroup setDelegate:self];
    return animGroup;
}

```
@ç”¨ä¸€ä¸ªå‚æ•°æŽ§åˆ¶æ•´ä½“çš„åŠ¨ç”»çš„ç»§ç»­å’Œåœæ­¢ï¼Œå°±æ˜¯`_animIndex`
æ¯ä¸€ä¸ªåŠ¨ç”»groupæ‰§è¡Œå®Œæ¯•åŽï¼Œåœ¨ `- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag` ä¸­è¿›è¡Œ`_animIndex--`ï¼Œå¹¶ä¸”æ·»åŠ ä¸‹ä¸€ç»„åŠ¨ç”»ï¼Œçœ‹ä»£ç ï¼š
```
// - MARK: Animation Delegate
- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag {
    if (flag && _animIndex > 0) {
        _animIndex--;
        _animLabel.text = [NSString stringWithFormat:@"%ld",(long)_animIndex];
        [_animLabel.layer addAnimation:[self animationGroup] forKey:nil];
    }
    //åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åŽ æ‰§è¡Œçš„æ“ä½œ
    if (_animIndex == 0) {
        if (_completeBlock != nil) {
            //å»¶è¿Ÿ0.4sä¹‹åŽ å†å¼€å§‹æ¸¸æˆ é˜²æ­¢æ¸¸æˆå¼€å§‹å¤ªå¿« useræŽ¥å—ä¸äº†
            self.hidden = true;
            WeakSelf;
            dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.4 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
                _completeBlock();
                [weakSelf.animLabel.layer removeAllAnimations];
                weakSelf.hidden = false;
                [weakSelf removeFromSuperview];
            });
        }
    }
}
```
 ##### æ¸¸æˆç•Œé¢å¦‚ä½•æ­å»º
â‘ é¦–é¡µæ•´ä½“ç•Œé¢æ­å»º
![B7A2A5EB-B936-4ABD-BF2A-F6135389EC0C.png](http://upload-images.jianshu.io/upload_images/1299512-23020b7609d725bd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
ç•Œé¢ä¸­æ¯ä¸€ä¸ªè¢«æˆ‘æ¡†èµ·æ¥çš„éƒ½æ˜¯æˆ‘å°è£…çš„ `GameSceneView`,å½“ç„¶æˆ‘ä»¬ä¸èƒ½åœ¨æ¯ä¸€ä¸ª`GameSceneView`é‚£å¦‚ä½•å®žçŽ°''é‡ç”¨'å‘¢'
**å®žçŽ°æ€è·¯ï¼š**
â‘ è®¡ç®—ä½ çš„å±å¹•ä¸­éœ€è¦å¤šå°‘ä¸ª`gameScene`ï¼Œ
```
// - 1: å…ˆè®¡ç®—å‡º å±å¹•ä¸­éœ€è¦å¤šå°‘ä¸ª scene
    _sceneCount = ceil(SCREEN_HEIGHT / WhiteBlockHeight) + 1;
```
â‘¡åˆ›å»ºä¸Žä¹‹ç­‰åŒæ•°é‡çš„scene
`_frameArray `å­˜å‚¨çš„æ˜¯ sceneåˆ›å»ºæ—¶çš„åˆå§‹frame,ä¾¿äºŽç‚¹å‡»é”™è¯¯æ—¶ï¼Œç›´æŽ¥æ¢å¤åˆ°åˆå§‹çš„frame
`_operateArray `å°†åˆ›å»ºå¥½çš„sceneé›†ä¸­åˆ°ä¸€èµ·ï¼Œä¾¿äºŽç®¡ç†
```
[_frameArray addObject:[NSValue valueWithCGRect:scene.frame]];
[_operateArray addObject:scene];
```
å±å¹•ä¸Šæ‰€æœ‰çš„ `scene`éƒ½æ˜¯å‘ä¸‹æ»šåŠ¨çš„ï¼Œæ¯æ¬¡æ»šåŠ¨åˆ¤æ–­æ˜¯å¦è¶…å‡ºå±å¹•ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æ­£ç¡®ã€sceneæ¼‚ç§»åˆ°å±å¹•å¤–çš„æ—¶å€™ï¼Œå†æ›´æ–°`scene`çš„`frame`ï¼Œè¿™ä¸ªsceneå°†è¢«å®‰æŽ’åˆ°æœ€åŽä¸€ä¸ª`scene`çš„åŽé¢ï¼Œä¸Šä»£ç ï¼š
```
- (void)viewWillAppear:(BOOL)animated {
    [super viewWillAppear:animated];
    
    //ç”¨ CADisplayLink è¿›è¡Œåˆ·æ–° é¢‘çŽ‡æ›´å¿«ï¼ŒåŠ¨ç”»æ•ˆæžœä¸ä¼šå¡é¡¿
    disPlayLink = [CADisplayLink displayLinkWithTarget:self selector:@selector(startScroll)];
    
    //å…ˆæ‰§è¡Œ 3 2 1 è¿™æ ·çš„åŠ¨ç”»
    [[StartAnimView shareInstance] showWithAnimNum:3 CompleteBlock:^{
        [disPlayLink addToRunLoop:[NSRunLoop currentRunLoop] forMode:NSRunLoopCommonModes];
    }];
}
```
disPlayLinkä¸€ç›´åœ¨è°ƒç”¨ `- (void)startScroll`è¿™ä¸ªæ–¹æ³•ï¼Œåˆ·æ–°ç•Œé¢
```
//å¼€å§‹æ»šåŠ¨
- (void)startScroll {
    WeakSelf;
    
    [_operateArray enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        //
        dispatch_async(dispatch_get_main_queue(), ^{
            GameSceneView *scene = (GameSceneView *)obj;
            CGRect frame = scene.frame;
            frame.origin.y += _gameSpeed * 2.0;
            if (!*stop) {
                scene.frame = frame;
            }

            //  ç”¨æˆ·ç‚¹å‡»è¶…æ—¶æ²¡æœ‰ç‚¹å‡»
            if ( scene.frame.origin.y >= SCREEN_HEIGHT && scene.completeType == CompleteTypeNotClick)
            {
                //åœæ­¢åˆ·æ–°
                [disPlayLink invalidate];
                *stop = false;
                
                //å¼¹å‡ºå¤±è´¥é¡µé¢
                [weakSelf resetGame];
        
            }else if( scene.frame.origin.y > SCREEN_HEIGHT && scene.completeType == CompleteTypeVictory){
                // ç”¨æˆ·ç‚¹å‡»æˆåŠŸ  è®¡ç®—æ–°çš„frame
                scene.frame = [weakSelf calculateNewFrameWithTag:scene.tag];
                [scene reSet];
            }
        });
    }];
    
}

```

ç‚¹å‡»æ­£ç¡®ä¹‹åŽ è®¡ç®—è¯¥ `scene`æ–°çš„frame
```
//ç‚¹å‡»æ­£ç¡®ä¹‹åŽ å°†è¶…å‡ºå±å¹•çš„scene æ”¹å˜frame ï¼Œè®©çŽ©å®¶æ„Ÿè§‰ä¸€ç›´æœ‰æ–°sceneçš„å‡ºæ¥
- (CGRect)calculateNewFrameWithTag: (NSInteger )tag {
    tag = tag == 0 ? _sceneCount - 1 : tag - 1;
    
    GameSceneView *scene = (GameSceneView *)[_operateArray objectAtIndex:tag];
    CGRect frame = scene.frame;
    frame.origin.y -= WhiteBlockHeight;
    return frame;
}
```
è¿™ä¸€éƒ¨åˆ†ç”¨å›¾å¾ˆå¥½è§£é‡Šï¼š

![tmp13f239f2.png](http://upload-images.jianshu.io/upload_images/1299512-4e87160e38bfa764.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
çº¢è‰²æ¡†ä¸ºå±å¹•èŒƒå›´ï¼Œ ç¬¬0ä¸ª`scene`è¶…å‡ºå±å¹•åŽï¼Œæ–°çš„ä½ç½®å³åœ¨ ç¬¬4ä¸ª`scene`çš„åŽé¢

 ##### GameSceneView çš„æž„å»º
è¿™ä¸€éƒ¨åˆ†æœ‰ä¸€ä¸ªå°é—æ†¾ï¼Œåº”è¯¥å°†æ¯è¡Œçš„buttonæ•°é‡å†™æˆ å‚æ•°ï¼Œä¸åº”è¯¥å†™æˆ4ðŸ˜€
æ¯ä¸ªbuttoné€šè¿‡  button.layerçš„borderColor å’Œ borderWidthå±žæ€§è®¾ç½®è¾¹æ¡†ï¼Œæ‰€ä»¥æ˜¾çš„æœ‰ç‚¹ç²—ç³™ã€‚
ä¸»è¦ä»£ç ï¼š
```
// - MARK: private method
//å¿«é€Ÿæž„å»ºbutton
- (UIButton *)quickCreateButtonWithFrame:(CGRect)frame{
    UIButton *btn = [[UIButton alloc] initWithFrame:frame];
    
    btn.selected = false;
    btn.layer.borderColor = [UIColor blackColor].CGColor;
    btn.layer.borderWidth = 0.5;
    btn.backgroundColor = [UIColor whiteColor];

    WeakSelf;
    [[[btn rac_signalForControlEvents:UIControlEventTouchUpInside]
      map:^id(id value) {
          if(!weakSelf.isHasOtherSelected && weakSelf.goalIndex == btn.tag){
              // æ²¡äººç‚¹å‡» and ç‚¹å‡»æŒ‰é’®ä¸ºç›®æ ‡æŒ‰é’® -> clickæ­£ç¡®
              btn.selected = false;
              weakSelf.isHasOtherSelected = true;
              weakSelf.completeType = CompleteTypeVictory;
//              [SoundPlayer playWithMusicName:_effect];
              weakSelf.clickBlock(CompleteTypeVictory);
              return [UIColor whiteColor];
          }else if(!weakSelf.isHasOtherSelected && weakSelf.goalIndex != btn.tag) {
              //ç‚¹å‡»btn ä¸æ˜¯ ç›®æ ‡ -> clické”™è¯¯
              weakSelf.completeType = CompleteTypeFailure;
              weakSelf.isHasOtherSelected = true;
//              [SoundPlayer playWithMusicName:ErrorEffect];
              //ç‚¹å‡»é”™è¯¯ä¹‹åŽ å°†æ­£ç¡®çš„btn æ‰§è¡ŒåŠ¨ç”»
              [weakSelf clickButtonFailureWithButton:btn];
              return [UIColor orangeColor];
          }
          return [UIColor whiteColor];
          
    } ]subscribeNext:^(UIColor *color) {
        btn.backgroundColor = color;
    }];
    
    return btn;
}

```
è§£é‡Šä¸€ä¸‹ï¼š
**å¯¹äºŽå…¶ä¸­`ReactiveCocoa`çš„è§£é‡Š**
`[btn rac_signalForControlEvents:UIControlEventTouchUpInside]`å°±æ˜¯å½“ä½ ç‚¹å‡»buttonçš„æ—¶å€™ ä¼šå‘å‡ºä¸€ä¸ªä¿¡å·ï¼Œ` map:^id(id value) { ........}`æ˜¯æŽ¥å—åˆ°è¯¥ä¿¡å·ä¹‹åŽï¼Œä½ åšçš„ä¸€äº›æ“ä½œï¼Œè¿”å›žä¸€ä¸ªvalueå¯¹è±¡ ï¼Œ`subscribeNext:^(id value) {.......}` å°±æ˜¯ å¯¹äºŽæŽ¥å—åˆ°çš„`value`åšçš„ä¸€äº›æ“ä½œ

ç”¨ä¸€ä¸ªæ¯”å–»æ¥è¯´ï¼Œ`[btn rac_signalForControlEvents:UIControlEventTouchUpInside]` å°±æ˜¯æ°´æºï¼Œ` map:^id(id value) { ........}`å°±æ˜¯å†œå¤«å±±æ³‰åŠ å·¥åŽ‚ï¼Œ`subscribeNext:^(id value) {.......}`å°±æ˜¯æ°´é€åˆ°ä½ æ‰‹é‡Œäº†ï¼Œä½ è¦å¹²ä»€ä¹ˆï¼Œæ´—è„¸æ´—è„šå–æŽ‰éšä¾¿ä½ ã€‚ã€‚

**å¯¹äºŽæ¸¸æˆé€»è¾‘çš„è§£é‡Šï¼š**
â‘ `isHasOtherSelected`è¿™ä¸ªboolç±»åž‹çš„å˜é‡ ï¼š
trueä»£è¡¨å·²ç»æœ‰ä¸€ä¸ªbuttonè¢«ç‚¹å‡»  falseä»£è¡¨æ²¡æœ‰buttonè¢«ç‚¹å‡» 
â‘¡æ ¹æ®ç‚¹å‡»æˆåŠŸä¸Žå¦,è¿”å›žå®ŒæˆçŠ¶æ€completeType
ç‚¹å‡»æˆåŠŸï¼š`weakSelf.clickBlock(CompleteTypeVictory);`
ç‚¹å‡»å¤±è´¥ï¼š
```
//ç‚¹å‡»é”™è¯¯ä¹‹åŽ  å°†å¤±è´¥çš„btn é—ªçƒä¸‹
              [weakSelf clickButtonFailureWithButton:btn];
```
buttoné—ªçƒåŠ¨ç”»å¦‚ä¸‹
```
//ç‚¹å‡»é”™è¯¯ è®©ç‚¹é”™çš„button é—ªçƒ
- (void)clickButtonFailureWithButton:(UIButton *)sender{
    
    CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@"opacity"];//å¿…é¡»å†™opacityæ‰è¡Œã€‚
    animation.fromValue = [NSNumber numberWithFloat:1.0f];
    animation.toValue = [NSNumber numberWithFloat:0.0f];//è¿™æ˜¯é€æ˜Žåº¦ã€‚
    animation.autoreverses = YES;
    animation.duration = 0.2;
    animation.repeatCount = 4;
    animation.removedOnCompletion = NO;
    animation.fillMode = kCAFillModeForwards;
    animation.timingFunction=[CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn];///æ¸è¿›åŠ¨ç”»
    [animation setDelegate:self];
    [sender.layer addAnimation:animation forKey:nil];
}

//é—ªçƒå®Œæ¯•åŽ è¿”å›žå¤±è´¥çŠ¶æ€
- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag {
    if (flag) {
        self.clickBlock(CompleteTypeFailure);
    }
}
```

 ##### éŸ³é¢‘å¤„ç†ã€
`SoundPlayer`è¿™ä¸ªç±»è´Ÿè´£æ’­æ”¾éŸ³é¢‘,è°ƒç”¨`AVAudioPlayer`æ¥æ’­æ”¾éŸ³é¢‘
æœ‰ä¸‰ä¸ªæ–¹æ³•:
```
//æŒ‰é’®ç‚¹å‡»æ—¶æ’­æ”¾çš„å£°éŸ³
+ (void)playWithMusicName: (NSString *)fileName;

//æ’­æ”¾èƒŒæ™¯éŸ³ä¹
+ (void)playBackgroundMusicWithName: (NSString *)fileName;

//æš‚åœèƒŒæ™¯éŸ³ä¹
+ (void)pauseBGM;
```
**å…³äºŽç‚¹å‡»éŸ³æ•ˆçš„å¤„ç†**
æˆ‘æœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼Œéƒ½åœ¨ä»£ç é‡Œé¢
â‘ ç‚¹å‡»æŒ‰é’®æ—¶ï¼ŒæŒ‰ç‚¹å‡»æ¬¡æ•°æ¥æ’­æ”¾å¯¹åº”çš„å£°éŸ³ï¼š
å…·ä½“å®žçŽ°ï¼š
```
if (type == CompleteTypeVictory) {
        //ç‚¹å‡»æˆåŠŸ  æ’­æ”¾ç›¸åº”çš„ music
        if (_clickIndex > 213) {
            _clickIndex = (NSInteger)_clickIndex % 213;
        }
        NSString *fileName = [NSString stringWithFormat:@"C-%ld",_clickIndex];
        if (_clickIndex <= 9) {
            fileName = [NSString stringWithFormat:@"C-0%ld",_clickIndex];
        }

        [SoundPlayer playWithMusicName:fileName];
        // æ›´æ–°å½“å‰åˆ†æ•°
        _currentScore += 1.0;
        // æ ¹æ®å½“å‰åˆ†æ•° è®¡ç®—ç™½å—ç§»åŠ¨é€Ÿåº¦
        [self updateGameSpeed];
    }
```
**å…³äºŽéŸ³é¢‘çš„æ¥æº**ï¼šæˆ‘å°† *é©¬å…‹è¥¿å§†* çš„**å…‹ç½—åœ°äºšç‹‚æƒ³æ›²**åˆ†æˆäº†æ¯ä¸ªéƒ¨åˆ†ä¸º1sçš„ç‰‡æ®µ,å¤§æ¦‚200å¤šä¸ªç‰‡æ®µ
è¿™ä¸€éƒ¨åˆ†æœ‰ä¸ª**ç–‘é—®**:å£°éŸ³æ–‡ä»¶ä¸€èˆ¬ä¸æ˜¯åˆ†ä¸ºå·¦å³å£°é“å—ï¼Œæˆ‘å°†å…¶ä¸­ä¸€ä¸ªå£°é“æŠ½ç¦»å‡ºæ¥å½“åšèƒŒæ™¯éŸ³ä¹ï¼Œå¦ä¸€ä¸ªå£°é“æ–‡ä»¶åˆ†æˆè‹¥å¹²åˆ†ï¼Œå½“æŒ‰é’®ç‚¹å‡»æ—¶æ’­æ”¾æ˜¯ä¸æ˜¯æ›´å¥½ï¼Ÿæ‡‚ç”µå­éŸ³é¢‘å¤„ç†çš„æœ‹å‹å‡ºæ¥å›žç­”ä¸‹å‘—ã€‚

##é¡¹ç›®æ„Ÿæƒ³
â‘ å…¶å®žå¤æ‚åŠ¨ç”»ä¹Ÿæ˜¯ "ç¼©æ”¾" "æ—‹è½¬" "æ”¹å˜é€æ˜Žåº¦" "ç§»åŠ¨"ç­‰ä¸€äº›åŸºç¡€åŠ¨ç”»çš„ç»„åˆï¼Œä¸‹æ¬¡é‡åˆ°åŠ¨ç”»çš„æ—¶å€™å¯ä»¥è¯•ç€å°†åŠ¨ç”»è¿›è¡Œåˆ†è§£ï¼Œè¿™æ ·å°±ä¼šå‡å°å®žçŽ°çš„éš¾åº¦ï¼Œ
â‘¡å°½é‡å°†ä»£ç å†™çš„æ¸…æ™°æ˜“æ‡‚ï¼Œä¸å¿™çš„æ—¶å€™å¤šå›žåŽ»reviewä»£ç ï¼Œå°±å¯ä»¥å‘çŽ°å½“åˆä»£ç çš„ä¸€äº›ä¸åˆç†çš„é€»è¾‘ï¼Œè¿™æ ·æ‰ä¼šè¿›æ­¥ï¼Œè¿™äº›å¤©å›žåŽ»å°†æˆ‘çš„[é«˜ä»¿åŠç³–app](http://www.jianshu.com/p/7b57eb0c4abe) reviewä¸‹ï¼Œå¤äººè€è¯ï¼Œ**æ¸©æ•…è€ŒçŸ¥æ–° å¯ä»¥ä¸ºå¸ˆçŸ£**
â‘¢å­¦ä¹ ä¹‹è·¯ï¼Œ**ä»»é‡è€Œé“è¿œï¼Œè·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢**
##Githubé¡¹ç›®ä¸‹è½½åœ°å€
**æ¸©é¦¨æç¤ºï¼š**appå¯åŠ¨åŽ ä¼šæœ‰èƒŒæ™¯éŸ³ä¹å“èµ·ï¼Œsoï¼Œä½ æ‡‚çš„ï¼Œç‚¹å‡»æŒ‰é’®ä¹Ÿä¼šæ’­æ”¾ **å…‹ç½—åœ°äºšç‹‚æƒ³æ›²**çš„ç‰‡æ®µï¼Œè¿è¡Œæ—¶è¯·è¯·è°ƒä½ŽéŸ³é‡
![è¯·è¿è¡Œ.xcworkspace](http://upload-images.jianshu.io/upload_images/1299512-d22eeea07435f018.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
[ç‚¹å‡»åŽ»æˆ‘çš„Githubä¸‹è½½](https://github.com/jiachenmu/Don-tTapTheWhiteTile)

##æˆ‘çš„ç®€ä¹¦åœ°å€
[ç‚¹å‡»åŽ»æˆ‘çš„ç®€ä¹¦](http://www.jianshu.com/p/fd4c46c31508)

**å·¥ä½œäº‹å®œåŠé—®é¢˜äº¤æµè¯·è”ç³»QQ: 1691919529**


